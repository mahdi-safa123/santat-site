<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· - ØªØ³Ø¬ÙŠÙ„ ÙˆØ­Ø³Ø§Ø¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f8f8; direction: rtl; }
    input, textarea { width: 100%; padding: 8px; margin: 5px 0; }
    button { padding: 10px; margin-top: 10px; }
    .hidden { display: none; }
    .card { background: white; padding: 15px; margin: 15px 0; border-radius: 10px; box-shadow: 0 0 5px #ccc; }
  </style>
</head>
<body>
  <h1>ğŸ¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· - ÙØªØ­ Ø­Ø³Ø§Ø¨</h1>

  <div id="userInfo" class="card hidden"></div>

  <div id="authForms">
    <div class="card">
      <h3>ğŸ” Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
      <input id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
      <input id="regEmail" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
      <input id="regPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
      <div id="regMsg"></div>
    </div>

    <div class="card">
      <h3>ğŸ“¥ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
      <input id="logEmail" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
      <input id="logPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
      <div id="logMsg"></div>
    </div>
  </div>

  <div id="mainApp" class="hidden">
    <button onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

    <div class="card">
      <h3>ğŸª™ Ø´Ø±Ø§Ø¡ Ù†Ù‚Ø§Ø·</h3>
      <input id="points" type="number" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·">
      <button onclick="buyPoints()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</button>
      <div id="currentBalance"></div>
    </div>

    <div class="card">
      <h3>ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø©</h3>
      <textarea id="noteTxt" placeholder="Ù…Ù„Ø§Ø­Ø¸ØªÙƒ..."></textarea>
      <button onclick="saveNote()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>

    <div class="card">
      <h3>ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
      <button onclick="exportCSV()">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV</button>
    </div>

    <div class="card">
      <h3>ğŸ‘‘ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h3>
      <input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø´Ø±Ù">
      <button onclick="adminLogin()">Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
      <div id="adminPanel" class="hidden">
        <h4>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…:</h4>
        <div id="adminData"></div>
      </div>
    </div>
  </div>

  <script>
    let current = null;
    const adminPassword = "admin123";

    function register() {
      const u = {
        name: regName.value,
        email: regEmail.value,
        pass: regPass.value,
        balance: 0,
        notes: []
      };
      if (!u.name || !u.email || !u.pass) {
        regMsg.innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
        return;
      }
      localStorage.setItem("user_" + u.email, JSON.stringify(u));
      regMsg.innerText = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨";
    }

    function login() {
      const u = JSON.parse(localStorage.getItem("user_" + logEmail.value));
      if (!u || u.pass !== logPass.value) {
        logMsg.innerText = "âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
        return;
      }
      current = u;
      showApp();
    }

    function showApp() {
      authForms.classList.add("hidden");
      mainApp.classList.remove("hidden");
      updateUI();
    }

    function logout() {
      current = null;
      authForms.classList.remove("hidden");
      mainApp.classList.add("hidden");
      userInfo.classList.add("hidden");
    }

    function buyPoints() {
      if (!current) return alert("Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
      const pts = +points.value;
      const cost = (pts / 5000) * 1320;
      current.balance += pts;
      updateUser();
      updateUI();
      alert("âœ… Ø§Ù„Ø³Ø¹Ø±: " + cost.toFixed(2) + " Ø±ÙŠØ§Ù„");
    }

    function updateUI() {
      userInfo.classList.remove("hidden");
      userInfo.innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${current.name} | Ø±ØµÙŠØ¯Ùƒ: ${current.balance} Ù†Ù‚Ø·Ø©`;
      currentBalance.innerText = `Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${current.balance}`;
    }

    function saveNote() {
      const txt = noteTxt.value.trim();
      if (!txt) return;
      current.notes.push({ text: txt, at: new Date().toLocaleString() });
      updateUser();
      noteTxt.value = "";
      alert("ğŸ“© ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©");
    }

    function updateUser() {
      localStorage.setItem("user_" + current.email, JSON.stringify(current));
    }

    function exportCSV() {
      const csv = [["Ù…Ù„Ø§Ø­Ø¸Ø©", "Ø§Ù„ÙˆÙ‚Øª"]];
      current.notes.forEach(n => csv.push([n.text, n.at]));
      const blob = new Blob([csv.map(r => r.join(",")).join("\n")], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "notes.csv";
      a.click();
    }

    function adminLogin() {
      if (adminPass.value !== adminPassword) return alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©");
      const panel = document.getElementById("adminPanel");
      const data = document.getElementById("adminData");
      panel.classList.remove("hidden");
      let html = "";
      Object.keys(localStorage).forEach(k => {
        if (k.startsWith("user_")) {
          const u = JSON.parse(localStorage.getItem(k));
          html += `<p><strong>${u.name}</strong> â€“ ${u.email} â€“ Ù†Ù‚Ø§Ø·: ${u.balance}</p>`;
        }
      });
      data.innerHTML = html;
    }
  </script>
</body>
</html>
